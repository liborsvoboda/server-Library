!function(t,e){var r=typeof define==="function",n=typeof module!=="undefined"&&module.exports;if(r){define(e)}else if(n){module.exports=e(require("debug")("eventproxy"))}else{this[t]=e()}}("EventProxy",function(t){t=t||function(){};var e=Array.prototype.slice;var r=Array.prototype.concat;var n="__all__";var i=function(){if(!(this instanceof i)){return new i}this._callbacks={};this._fired={}};i.prototype.addListener=function(e,r){t("Add listener for %s",e);this._callbacks[e]=this._callbacks[e]||[];this._callbacks[e].push(r);return this};i.prototype.bind=i.prototype.addListener;i.prototype.on=i.prototype.addListener;i.prototype.subscribe=i.prototype.addListener;i.prototype.headbind=function(e,r){t("Add listener for %s",e);this._callbacks[e]=this._callbacks[e]||[];this._callbacks[e].unshift(r);return this};i.prototype.removeListener=function(e,r){var n=this._callbacks;if(!e){t("Remove all listeners");this._callbacks={}}else{if(!r){t("Remove all listeners of %s",e);n[e]=[]}else{var i=n[e];if(i){var o=i.length;for(var a=0;a<o;a++){if(r===i[a]){t("Remove a listener of %s",e);i[a]=null}}}}}return this};i.prototype.unbind=i.prototype.removeListener;i.prototype.removeAllListeners=function(t){return this.unbind(t)};i.prototype.bindForAll=function(t){this.bind(n,t)};i.prototype.unbindForAll=function(t){this.unbind(n,t)};i.prototype.trigger=function(r,i){var o,a,s,l,p,u;var f=2;var c=this._callbacks;t("Emit event %s with data %j",r,i);while(f--){a=f?r:n;o=c[a];if(o){for(p=0,u=o.length;p<u;p++){if(!(s=o[p])){o.splice(p,1);p--;u--}else{l=f?e.call(arguments,1):arguments;s.apply(this,l)}}}}return this};i.prototype.emit=i.prototype.trigger;i.prototype.fire=i.prototype.trigger;i.prototype.once=function(t,e){var r=this;var n=function(){e.apply(r,arguments);r.unbind(t,n)};this.bind(t,n);return this};var o=typeof process!=="undefined"&&process.nextTick||function(t){setTimeout(t,0)};i.prototype.emitLater=function(){var t=this;var e=arguments;o(function(){t.trigger.apply(t,e)})};i.prototype.immediate=function(t,e,r){this.bind(t,e);this.trigger(t,r);return this};i.prototype.asap=i.prototype.immediate;var a=function(r,n,i,o){var a=this;var s=arguments.length;var l=0;var p={};if(s<3){return this}var u=e.call(arguments,0,-2);var f=arguments[s-2];var c=arguments[s-1];if(typeof f!=="function"){return this}t("Assign listener for events %j, once is %s",u,!!c);var y=function(t){var e=c?"once":"bind";a[e](t,function(e){a._fired[t]=a._fired[t]||{};a._fired[t].data=e;if(!p[t]){p[t]=true;l++}})};var v=u.length;for(var d=0;d<v;d++){y(u[d])}var h=function(e){if(l<v){return}if(!p[e]){return}var r=[];for(var n=0;n<v;n++){r.push(a._fired[u[n]].data)}if(c){a.unbindForAll(h)}t("Events %j all emited with data %j",u,r);f.apply(null,r)};a.bindForAll(h)};i.prototype.all=function(t,e,n){var i=r.apply([],arguments);i.push(true);a.apply(this,i);return this};i.prototype.assign=i.prototype.all;i.prototype.fail=function(t){var e=this;e.once("error",function(r){e.unbind();t.apply(null,arguments)});return this};i.prototype.tail=function(){var t=r.apply([],arguments);t.push(false);a.apply(this,t);return this};i.prototype.assignAll=i.prototype.tail;i.prototype.assignAlways=i.prototype.tail;i.prototype.after=function(e,r,n){if(r===0){n.call(null,[]);return this}var i=this,o=[];this._after=this._after||{};var a=e+"_group";this._after[a]={index:0,results:[]};t("After emit %s times, event %s's listenner will execute",r,e);var s=function(l,p){if(l===e){r--;o.push(p);if(r<1){t("Event %s was emit %s, and execute the listenner",e,r);i.unbindForAll(s);n.apply(null,[o])}}if(l===a){r--;i._after[a].results[p.index]=p.result;if(r<1){t("Event %s was emit %s, and execute the listenner",e,r);i.unbindForAll(s);n.call(null,i._after[a].results)}}};i.bindForAll(s);return this};i.prototype.group=function(t,r){var n=this;var i=t+"_group";var o=n._after[i].index;n._after[i].index++;return function(t,a){if(t){return n.emit.apply(n,["error"].concat(e.call(arguments)))}n.emit(i,{index:o,result:r?r.apply(null,e.call(arguments,1)):a})}};i.prototype.any=function(){var r=this,n=arguments[arguments.length-1],i=e.call(arguments,0,-1),o=i.join("_");t("Add listenner for Any of events %j emit",i);r.once(o,n);var a=function(e){r.bind(e,function(n){t("One of events %j emited, execute the listenner");r.trigger(o,{data:n,eventName:e})})};for(var s=0;s<i.length;s++){a(i[s])}};i.prototype.not=function(e,r){var n=this;t("Add listenner for not event %s",e);n.bindForAll(function(n,i){if(n!==e){t("listenner execute of event %s emit, but not event %s.",n,e);r(i)}})};i.prototype.done=function(t,r){var n=this;return function(i,o){if(i){return n.emit.apply(n,["error"].concat(e.call(arguments)))}var a=e.call(arguments,1);if(typeof t==="string"){if(r){return n.emit(t,r.apply(null,a))}else{return n.emit.apply(n,[t].concat(a))}}if(arguments.length<=2){return t(o)}t.apply(null,a)}};i.prototype.doneLater=function(t,e){var r=this.done(t,e);return function(t,e){var n=arguments;o(function(){r.apply(null,n)})}};i.create=function(){var t=new i;var e=r.apply([],arguments);if(e.length){var n=e[e.length-1];var o=e[e.length-2];if(typeof n==="function"&&typeof o==="function"){e.pop();t.fail(n)}t.assign.apply(t,e)}return t};i.EventProxy=i;return i});